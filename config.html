<html>

    <head>
        <title>CleanFace Settings</title>

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/cosmo/bootstrap.min.css" rel="stylesheet">

        <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

        <script type="text/javascript">
            var config = {};

            function GetQueryParam(variable, defValue) {
                var query = location.search.substring(1);
                var vars  = query.split('&');

                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split('=');
                    if (pair[0] === variable) {
                        if (pair[1] !== null)
                            return decodeURIComponent(pair[1]);
                    }
                }

                return defValue || false;
            };

            function ValueChanged(key, value) {
                console.log('option changed: {%s:%s}', key, value);
                config[key] = value;
            };

            function ReadConfig() {
                var draw_invert = GetQueryParam('draw_invert', false).toString().toUpperCase();
                config['draw_invert'] = (draw_invert === "TRUE");

                console.log('dumping config');
                console.log(config);
                
                SetStartingValues();
            };

            function HideOptions() {
                $('#draw_invert').hide();
            };

            function ShowOptions() {
                $('#draw_invert').show();
            };

            function SetStartingValues() {
                HideOptions();

                $('#draw_invert').prop('checked', config.draw_invert);

                ShowOptions();
            };

            function SaveAndExit() {
                config.draw_invert = $('#draw_invert').prop('checked');

                var return_to = GetQueryParam('return_to', 'pebblejs://close#');
                document.location = return_to + encodeURIComponent(JSON.stringify(config));
            };

            // ON LOAD
            $(function () {
                ReadConfig();
            });
        </script>
    </head>

    <body>
        <div class="container">
            <h1>CleanFace Settings</h1>

            <form>
                <input type="checkbox" name="draw_invert" id="draw_invert"
                    onclick="ValueChanged('draw_invert', this.checked)" />
                <label>Invert colors</label>
            </form>

            <button onclick="SaveAndExit()">Save and Close</button>
        </div>
    </body>

</html>
